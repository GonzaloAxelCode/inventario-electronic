<!-- Vista para ventas con comprobante generado -->
<div *ngIf="venta.estado !== 'PENDIENTE_A_SUNAT'"
  class="p-0 flex w-screenjustify-between dark:bg-neutral-950/30 bg-white ">


  <div class="flex flex-col flex-1 col-span-3 ">

    <div class="pt-8  px-5 sm:px-8 pb-0  overflow-hidden">

      <!-- Header del comprobante -->
      <div class="border-b border-neutral-200 dark:border-neutral-800 pb-4">
        <div class="flex flex-col lg:flex-row items-start justify-between gap-4">
          <div class="flex flex-col sm:flex-row gap-3 sm:gap-5 items-start sm:items-center w-full lg:w-auto">
            <a routerLink="/" class="inline-block mb-2 sm:mb-3">
              <img
                src="https://res.cloudinary.com/ddksrkond/image/upload/c_crop,w_500,h_210,g_auto/v1764500497/logofinal_pdsf0v.png"
                class="h-8 sm:h-10 dark:invert" alt="Logo">
            </a>


          </div>



          <div  *ngIf="venta.comprobante_nota_credito"  class="py-3 px-3">


            <tui-segmented class="w-[300px]">
              <button (click)="selectedState = 'original'" type="button">Comprobante Original</button>
              <button (click)="selectedState = 'anulado'" type="button">
                <span tuiFade>Comprobante Anulado</span>
              </button>
            </tui-segmented>

          </div>
        </div>


        <div *ngIf="venta.estado === 'ANULADA'"
          class="mt-4 px-4 py-2 bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-900 rounded-lg">
          <p class="text-sm font-medium text-red-700 dark:text-red-400">
            Este comprobante ha sido anulado en SUNAT
          </p>
        </div>
      </div>


      <div class="flex flex-col lg:flex-row gap-6 w-full lg:w-auto">

        <!-- Informaci贸n principal del comprobante -->
        <div  *ngIf="selectedState === 'original'"  class="flex flex-col gap-1">
          <p class="text-xs text-neutral-500 dark:text-neutral-400">N煤mero de comprobante</p>
          <p class="text-xl sm:text-2xl font-bold text-neutral-900 dark:text-neutral-100">
            {{ venta.comprobante.serie }} - {{ comprobante.correlativo }}
          </p>

          <p class="text-xs text-neutral-500 dark:text-neutral-400 mt-2">Fecha de comprobante</p>
          <p class="text-xs text-neutral-500 dark:text-neutral-400">
            {{ venta.fecha_realizacion || venta.fecha_hora | date:'mediumDate' }}
          </p>

          <p class="text-sm text-neutral-600 dark:text-neutral-400 mt-1">
            {{ comprobante.tipo_comprobante | uppercase }}
          </p>
        </div>
 <!-- Informaci贸n principal del comprobante anulado -->
        <div  *ngIf="selectedState === 'anulado'"  class="flex flex-col gap-1">
          <p class="text-xs text-neutral-500 dark:text-neutral-400">N煤mero de comprobante</p>
          <p class="text-xl sm:text-2xl font-bold text-neutral-900 dark:text-neutral-100">
                       {{ venta.comprobante_nota_credito.serie }} - {{ venta.comprobante_nota_credito.correlativo }} - AN
          </p>

          <p class="text-xs text-neutral-500 dark:text-neutral-400 mt-2">Fecha de anulacion</p>
          <p class="text-xs text-neutral-500 dark:text-neutral-400">
            {{ venta.comprobante_nota_credito.fecha_emision| date:'mediumDate' }}
          </p>

          <p class="text-sm text-neutral-600 dark:text-neutral-400 mt-1">
         NOTA DE CREDITO
          </p>
        </div>


        <div class="w-full sm:w-auto" *ngIf="selectedState === 'original' && venta.comprobante.estado_sunat == 'ACEPTADO' ">

          <div class="flex flex-wrap gap-2 mb-4">

            <!-- PDF -->
            <a [href]="stripDomain(comprobante.pdf_url)" target="_blank" class="flex flex-col items-center justify-center gap-1 sm:gap-2
         px-3 sm:px-4 py-2 sm:py-3
         bg-yellow-100 hover:bg-yellow-200
         dark:bg-yellow-900/30 dark:hover:bg-yellow-900/50
         rounded-lg transition-colors">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 text-yellow-700 dark:text-yellow-400" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
              </svg>
              <span class="text-xs font-semibold text-yellow-800 dark:text-yellow-400">
                PDF
              </span>
            </a>
            <!-- XML -->
            <a [href]="stripDomain(comprobante.xml_url)" target="_blank" class="flex flex-col items-center justify-center gap-1 sm:gap-2
             px-3 sm:px-4 py-2 sm:py-3
             bg-blue-100 hover:bg-blue-200
             dark:bg-blue-900/30 dark:hover:bg-blue-900/50
             rounded-lg transition-colors">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 text-blue-700 dark:text-blue-400" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
              </svg>
              <span class="text-xs font-semibold text-blue-700 dark:text-blue-400">XML</span>
            </a>

            <!-- CDR -->
            <a [href]="stripDomain(comprobante.cdr_url)" target="_blank" class="flex flex-col items-center justify-center gap-1 sm:gap-2
             px-3 sm:px-4 py-2 sm:py-3
             bg-green-100 hover:bg-green-200
             dark:bg-green-900/30 dark:hover:bg-green-900/50
             rounded-lg transition-colors">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 text-green-700 dark:text-green-400" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
              </svg>
              <span class="text-xs font-semibold text-green-700 dark:text-green-400">CDR</span>
            </a>

            <!-- Ticket -->
            <a [href]="stripDomain(comprobante.ticket_url)" target="_blank" class="flex flex-col items-center justify-center gap-1 sm:gap-2
             px-3 sm:px-4 py-2 sm:py-3
             bg-purple-100 hover:bg-purple-200
             dark:bg-purple-900/30 dark:hover:bg-purple-900/50
             rounded-lg transition-colors">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 text-purple-700 dark:text-purple-400" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
              </svg>
              <span class="text-xs font-semibold text-purple-700 dark:text-purple-400">Ticket</span>
            </a>
            <div class="flex items-center gap-2">
               <button     [disabled]="numeroInvalido || !numeroTelefonico"
 tuiButton  (click)="enviarWhatsApp(
    $event,
    stripDomain(comprobante.pdf_url),numeroTelefonico
  )" class="inline-flex flex-col h-full items-center justify-center gap-1 sm:gap-2
         px-3 sm:px-4 py-2 sm:py-3
         bg-green-100 hover:bg-green-200
         dark:bg-green-900/30 dark:hover:bg-green-900/50
         rounded-lg transition-colors cursor-pointer">

             <svg xmlns="http://www.w3.org/2000/svg" viewBox="-0.003 -293.41895027729095 1172.923 1474.5159502772908" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" width="20" height="20">
  <path d="M308.678 1021.49l19.153 9.576a499.739 499.739 0 0 0 258.244 70.227c279.729-.638 509.563-231.016 509.563-510.744 0-135.187-53.692-265.012-149.169-360.713-95.35-96.69-225.62-151.18-361.383-151.18-278.451 0-507.552 229.133-507.552 507.552 0 2.203 0 4.373.032 6.576a523.81 523.81 0 0 0 76.612 268.14l12.768 19.153-51.074 188.337 192.806-46.925z" fill="#00E676" fill-rule="nonzero"/>
  <path d="M1003.29 172.378C894.597 61.482 745.49-.732 590.225 0h-.99C269.479.001 6.35 263.131 6.35 582.888c0 1.5.032 2.969.032 4.47a616.759 616.759 0 0 0 76.612 290.485L-.003 1181.097l309.32-79.804a569.202 569.202 0 0 0 278.993 70.228c320.939-1.756 584.036-266.385 583.844-587.356.766-154.213-60.044-302.52-168.864-411.787m-413.065 900.186a473.935 473.935 0 0 1-245.476-67.035l-19.153-9.577-184.187 47.883 47.882-181.953-12.768-19.153a484.242 484.242 0 0 1-72.558-254.957c0-265.65 218.599-484.25 484.25-484.25 265.65 0 484.248 218.6 484.248 484.25 0 167.269-86.666 323.11-228.781 411.372a464.838 464.838 0 0 1-251.86 73.42m280.59-354.329l-35.114-15.96s-51.075-22.346-82.996-38.306c-3.192 0-6.384-3.192-9.577-3.192a46.308 46.308 0 0 0-22.345 6.384c-6.799 3.99-3.192 3.192-47.882 54.266-3.032 5.97-9.257 9.705-15.96 9.577h-3.193a24.328 24.328 0 0 1-12.768-6.384l-15.961-6.385a309.91 309.91 0 0 1-92.573-60.65c-6.384-6.385-15.96-12.77-22.345-19.154a357.13 357.13 0 0 1-60.65-76.611l-3.193-6.384a46.475 46.475 0 0 1-6.384-12.769 23.915 23.915 0 0 1 3.192-15.96c2.905-4.789 12.769-15.962 22.345-25.538 9.577-9.576 9.577-15.96 15.961-22.345a39.33 39.33 0 0 0 6.384-31.922 1246.398 1246.398 0 0 0-51.074-121.301 37.099 37.099 0 0 0-22.345-15.961H380.82c-6.384 0-12.768 3.192-19.153 3.192l-3.192 3.192c-6.384 3.192-12.768 9.577-19.153 12.769-6.384 3.192-9.576 12.769-15.96 19.153a162.752 162.752 0 0 0-35.114 98.956 189.029 189.029 0 0 0 15.96 73.42l3.193 9.576a532.111 532.111 0 0 0 118.11 162.8l12.768 12.769a193.037 193.037 0 0 1 25.537 25.537c66.141 57.554 144.7 99.052 229.516 121.302 9.576 3.192 22.345 3.192 31.921 6.384h31.922a118.126 118.126 0 0 0 47.882-12.769c7.82-3.543 15.29-7.82 22.345-12.768l6.384-6.385c6.385-6.384 12.769-9.576 19.153-15.96a84.393 84.393 0 0 0 15.961-19.153c6.129-14.301 10.438-29.304 12.769-44.69V724.62a40.107 40.107 0 0 0-9.577-6.385" fill="#fff" fill-rule="nonzero"/>
</svg>

              <span class="text-xs font-semibold text-green-800 dark:text-green-400">
                WhatsApp 
              </span>
              
            </button>
     <tui-input     (ngModelChange)="numeroTelefonico = $event; validarNumero($event)"


  class="w-[200px]"
  placeholder=" Ingrese el numero de 9 dijitos"
  [(ngModel)]="numeroTelefonico"
>
  Numero Telef贸nico
</tui-input>

            </div>
           


            <!-- Anular -->
            <button *ngIf="venta.estado !== 'ANULADA'" (click)="anularVenta(venta.id,venta.numero_documento_cliente)"
              [disabled]="loadingAnularVenta" class="flex flex-col items-center justify-center gap-1 sm:gap-2
             px-3 sm:px-4 py-2 sm:py-3
             bg-red-100 hover:bg-red-200
             dark:bg-red-900/30 dark:hover:bg-red-900/50
             rounded-lg transition-colors">
              <tui-loader *ngIf="loadingAnularVenta" size="s" class="text-white"></tui-loader>
              <svg *ngIf="!loadingAnularVenta" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
              </svg>

              <span class="text-xs font-semibold text-red-700 dark:text-red-400">Cancelar</span>
            </button>

          </div>
        </div>

 <div class="w-full sm:w-auto" *ngIf="selectedState === 'anulado' && venta.comprobante.estado_sunat == 'ACEPTADO'" >

          <div class="flex flex-wrap gap-2 mb-4">

            <!-- PDF -->
            <a [href]="stripDomain(venta.comprobante_nota_credito.pdf_url)" target="_blank" class="flex flex-col items-center justify-center gap-1 sm:gap-2
         px-3 sm:px-4 py-2 sm:py-3
         bg-yellow-100 hover:bg-yellow-200
         dark:bg-yellow-900/30 dark:hover:bg-yellow-900/50
         rounded-lg transition-colors">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 text-yellow-700 dark:text-yellow-400" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
              </svg>
              <span class="text-xs font-semibold text-yellow-800 dark:text-yellow-400">
                PDF(AN)
              </span>
            </a>
            <!-- XML -->
            <a [href]="stripDomain(venta.comprobante_nota_credito.xml_url)" target="_blank" class="flex flex-col items-center justify-center gap-1 sm:gap-2
             px-3 sm:px-4 py-2 sm:py-3
             bg-blue-100 hover:bg-blue-200
             dark:bg-blue-900/30 dark:hover:bg-blue-900/50
             rounded-lg transition-colors">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 text-blue-700 dark:text-blue-400" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
              </svg>
              <span class="text-xs font-semibold text-blue-700 dark:text-blue-400">XML(AN)</span>
            </a>

            <!-- CDR -->
            <a [href]="stripDomain(venta.comprobante_nota_credito.cdr_url)" target="_blank" class="flex flex-col items-center justify-center gap-1 sm:gap-2
             px-3 sm:px-4 py-2 sm:py-3
             bg-green-100 hover:bg-green-200
             dark:bg-green-900/30 dark:hover:bg-green-900/50
             rounded-lg transition-colors">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 text-green-700 dark:text-green-400" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
              </svg>
              <span class="text-xs font-semibold text-green-700 dark:text-green-400">CDR(AN)</span>
            </a>

           


            <!-- Anular -->
            <button *ngIf="venta.estado !== 'ANULADA'" (click)="anularVenta(venta.id,venta.numero_documento_cliente)"
              [disabled]="loadingAnularVenta" class="flex flex-col items-center justify-center gap-1 sm:gap-2
             px-3 sm:px-4 py-2 sm:py-3
             bg-red-100 hover:bg-red-200
             dark:bg-red-900/30 dark:hover:bg-red-900/50
             rounded-lg transition-colors">
              <tui-loader *ngIf="loadingAnularVenta" size="s" class="text-white"></tui-loader>
              <svg *ngIf="!loadingAnularVenta" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
              </svg>

              <span class="text-xs font-semibold text-red-700 dark:text-red-400">Cancelar</span>
            </button>

          </div>
        </div>

        
      </div>

      <!-- Informaci贸n Cliente y Detalles -->
      <div
        class="py-4 sm:py-6 grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8 border-b border-neutral-200 dark:border-neutral-800">

        <!-- Cliente -->
        <div>
          <p class="text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider mb-3">
            Informaci贸n del cliente
          </p>
          <div class="space-y-2">
            <p class="text-sm sm:text-base text-neutral-900 dark:text-neutral-100 font-medium">
              {{ comprobante.nombre_cliente || 'Cliente Ejemplo' }}
            </p>
            <p class="text-xs sm:text-sm text-neutral-600 dark:text-neutral-400 font-mono">
              {{ comprobante.numero_documento_cliente || '12345678' }}
            </p>
          </div>
          <div class="space-y-1 mt-2 text-xs sm:text-sm text-neutral-600 dark:text-neutral-400">
            <p>
               {{ venta.email_cliente || "Sin Correo"}}
            </p>
            <p>
               {{ venta.telefono_cliente || "Sin Tel茅fono"}}
            </p>
            <p>
               {{ venta.direccion_cliente || "Sin Direcci贸n"}}
            </p>
          </div>

        </div>

        <!-- Detalles del comprobante -->
        <div>
          <p class="text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider mb-3">
            Detalles del pago
          </p>
          <div class="space-y-2 text-xs sm:text-sm">
            <div class="flex justify-between">
              <span class="text-neutral-600 dark:text-neutral-400">M茅todo de pago</span>
              <span class="text-neutral-900 dark:text-neutral-100 font-medium">
                {{ venta.metodo_pago || 'Efectivo' }}
              </span>
            </div>
            <div class="flex justify-between">
              <span class="text-neutral-600 dark:text-neutral-400">Estado</span>
              <span class="text-neutral-900 dark:text-neutral-100 font-medium">
                <tui-chip>{{ venta.estado || 'Pendiente' }}</tui-chip>
              </span>
            </div>
          </div>
        </div>

      </div>

      <!-- Tabla de Items -->
      <div class=" py-2 overflow-x-auto">
        <table class="w-full min-w-[600px]">
          <thead>
            <tr class="border-b border-neutral-200 dark:border-neutral-800">
              <th
                class="pb-3 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider">
                Imagen
              </th>
              <th
                class="pb-3 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider">
                Art铆culo
              </th>
              <th
                class="pb-3 text-center text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider">
                Cant.
              </th>
              <th
                class="pb-3 text-right text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider">
                Precio Original
              </th>
              <th
                class="pb-3 text-right text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider">
                Descuento
              </th>

              <th
                class="pb-3 text-right text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider">
                Total
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-neutral-100 dark:divide-neutral-800">
            <tr *ngFor="let item of comprobante.items" class="group">
              <td class="py-4">




                <div
                  class="w-20 h-20 flex-shrink-0 rounded-lg overflow-hidden border-2 border-neutral-300 dark:border-neutral-600 shadow-sm">
                  <img loading="lazy" (click)="onSetImageProduct(item); open = true;"
                    [src]="item.producto_imagen ? URL_BASE + item.producto_imagen : 'https://sublimac.com/wp-content/uploads/2017/11/default-placeholder.png'"
                    [alt]="item.descripcion"
                    class="w-full h-full object-cover cursor-pointer active:scale-95 transition-transform" />
                </div>
              </td>
              <td class="py-4">
                <p class="text-sm sm:text-xl font-medium text-neutral-900 dark:text-neutral-100">
                  {{ item.descripcion }}
                </p>
                <p class="text-xs sm:text-xl text-neutral-500 dark:text-neutral-400 font-mono mt-0.5">
                  {{ item.codigo }}
                </p>
              </td>
              <td class="py-4 text-center text-sm sm:text-2xl font-medium text-neutral-900 dark:text-neutral-100">
                {{ item.cantidad }}
              </td>
              <td class="py-4 text-right text-sm sm:text-2xl text-neutral-700 font-bold dark:text-neutral-300">
                S/ {{ getValorVentaRedondeado(item.costo_original) }}


              </td>
              <td class="py-4 text-right text-sm sm:text-2xl text-neutral-700 dark:text-neutral-300 font-bold">
                <!--  S/ {{ getValorVentaRedondeado(item.valorUnitario) }}-->
                S/ {{ getValorVentaRedondeado(item.descuento) }}

              </td>

              <td class="py-4 text-right text-sm sm:text-2xl  text-neutral-900 dark:text-neutral-100 font-bold">
                S/ {{ getValorVentaRedondeado((item?.valorVenta || 0) + (item?.igv || 0)) }}
              </td>
            </tr>
          </tbody>

        </table>
      </div>



    </div>

    <div class="px-4 sm:px-8 rounded-b-xl py-4 sm:py-6 border-t border-neutral-200 dark:border-neutral-800">
      <div class=" ml-auto space-y-2">
        <div class="flex justify-between text-xs sm:text-sm">
          <span class="text-neutral-600 dark:text-neutral-400">Subtotal</span>
          <span class="text-neutral-900 dark:text-neutral-100 font-medium text-base sm:text-lg">
            S/ {{ getValorVentaRedondeado(comprobante.sub_total) +
            getValorVentaRedondeado(comprobante.descuento_total) }}
          </span>
        </div>

        <div class="flex justify-between text-xs sm:text-sm">
          <span class="text-neutral-600 dark:text-neutral-400">IGV (18%)</span>
          <span class="text-neutral-900 dark:text-neutral-100 font-medium text-base sm:text-lg">
            S/ {{ getValorVentaRedondeado(comprobante.igv) }}
          </span>
        </div>
        <div class="flex justify-between pt-2 border-t border-neutral-300 dark:border-neutral-700">
          <span class="font-semibold text-neutral-900 dark:text-neutral-100 text-sm sm:text-base">Total </span>
          <span class="text-3xl sm:text-3xl font-bold text-neutral-900 dark:text-neutral-100">
            S/ {{ getValorVentaRedondeado(comprobante.total) }}
          </span>
        </div>


      </div>
    </div>
  </div>

  <div *ngIf="venta.tipo_comprobante == 'Boleta' && venta.comprobante.estado_sunat == 'ACEPTADO'" class="lg:flex hidden bg-white">


    <iframe class="lg:flex hidden col-span-1 w-[360px] h-[120vh] border-0 overflow-hidden" [src]="prevPdfTicket(
    (venta?.comprobante?.ticket_url || comprobante?.ticket_url || '')
    + '#toolbar=0&navpanes=0&scrollbar=0&view=FitH'
  )" scrolling="no">
    </iframe>


  </div>
</div>

<!-- Vista para ventas pendientes -->
<div *ngIf="venta.estado == 'PENDIENTE_A_SUNAT'" class="p-3 sm:p-5">

  <div class="">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">

      <!-- Contenido Principal -->
      <div class="lg:col-span-2 space-y-4 sm:space-y-6">

        <!-- Card Principal de la Venta -->
        <div
          class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden">

          <!-- Header de la venta -->
          <div class="px-4 sm:px-8 py-4 sm:py-6 border-b border-neutral-200 dark:border-neutral-800">
            <div class="flex flex-col sm:flex-row items-start justify-between gap-4">
              <div>
                <a routerLink="/" class="inline-block mb-3">
                  <img
                    src="https://res.cloudinary.com/ddksrkond/image/upload/c_crop,w_350,h_150/v1755473642/APP%20INVENTARIO/T-removebg-preview_zgnu7f.png"
                    class="h-8 sm:h-10 dark:invert" alt="Logo">
                </a>
                <p class="text-xs text-neutral-500 dark:text-neutral-400">
                  {{venta.fecha_hora | date:'mediumDate' }}
                </p>
              </div>
              <div class="text-left sm:text-right w-full sm:w-auto">
                <p class="text-xs text-neutral-500 dark:text-neutral-400 mb-1">N煤mero de venta</p>
                <p class="text-xl sm:text-2xl font-bold text-neutral-900 dark:text-neutral-100">
                  {{ venta.id }}
                </p>
              </div>
            </div>
          </div>


          <!-- Informaci贸n Cliente y Detalles -->
          <div
            class="px-4 sm:px-8 py-4 sm:py-6 grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8 border-b border-neutral-200 dark:border-neutral-800">

            <!-- Cliente -->
            <div>
              <p class="text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider mb-3">
                Informaci贸n del cliente
              </p>
              <div class="space-y-2">
                <p class="text-sm sm:text-base text-neutral-900 dark:text-neutral-100 font-medium">
                  {{ venta.nombre_cliente || 'Cliente Ejemplo' }}
                </p>
                <p class="text-xs sm:text-sm text-neutral-600 dark:text-neutral-400 font-mono">
                  {{ venta.numero_documento_cliente || '12345678' }}
                </p>
              </div>
            </div>

            <!-- Detalles del comprobante -->
            <div>
              <p class="text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider mb-3">
                Detalles del pago
              </p>
              <div class="space-y-2 text-xs sm:text-sm">
                <div class="flex justify-between">
                  <span class="text-neutral-600 dark:text-neutral-400">M茅todo de pago</span>
                  <span class="text-neutral-900 dark:text-neutral-100 font-medium">
                    {{ venta.metodo_pago || 'Efectivo' }}
                  </span>
                </div>
                <div class="flex justify-between">
                  <span class="text-neutral-600 dark:text-neutral-400">Estado</span>
                  <span class="text-neutral-900 dark:text-neutral-100 font-medium">
                    {{ venta.estado || 'Pendiente' }}
                  </span>
                </div>
              </div>
            </div>

          </div>


          <!-- Tabla de Productos -->
          <div class="px-4 sm:px-8 py-4 sm:py-6 overflow-x-auto">
            <table class="w-full min-w-[500px]">
              <thead>
                <tr class="border-b border-neutral-200 dark:border-neutral-800">
                  <th
                    class="pb-3 text-left text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider">
                    Art铆culo
                  </th>
                  <th
                    class="pb-3 text-center text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider">
                    Cant.
                  </th>
                  <th
                    class="pb-3 text-right text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider">
                    Precio Original
                  </th>
                  <th
                    class="pb-3 text-right text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider">
                    Descuento
                  </th>

                  <th
                    class="pb-3 text-right text-xs font-semibold text-neutral-500 dark:text-neutral-400 uppercase tracking-wider">
                    Total
                  </th>
                </tr>
              </thead>

              <tbody class="divide-y divide-neutral-100 dark:divide-neutral-800">
                <tr *ngFor="let item of venta.productos" class="group">
                  <td class="py-4">
                    <p class="text-sm sm:text-md font-medium text-neutral-900 dark:text-neutral-100">
                      {{ item.descripcion }}
                    </p>
                    <p class="text-xs sm:text-sm text-neutral-500 dark:text-neutral-400 font-mono mt-0.5">
                      {{ item.codigo }}
                    </p>
                  </td>
                  <td class="py-4 text-center text-sm sm:text-md font-medium text-neutral-900 dark:text-neutral-100">
                    {{ item.cantidad }}
                  </td>
                  <td class="py-4 text-right text-sm sm:text-md text-neutral-700 dark:text-neutral-300">
                    S/ {{ getValorVentaRedondeado(item.costo_original || 0) }}

                  </td>
                  <td class="py-4 text-right text-sm sm:text-md text-neutral-700 dark:text-neutral-300">
                    <!--  S/ {{ getValorVentaRedondeado(item.valorUnitario) }}-->
                    S/ {{ getValorVentaRedondeado(item.descuento || 0) }}

                  </td>

                  <td class="py-4 text-right text-sm sm:text-md font-semibold text-neutral-900 dark:text-neutral-100">
                    S/ {{ getValorVentaRedondeado((item?.valor_venta || 0) + (item?.igv || 0)) }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Totales -->
          <div class="px-4 sm:px-8 py-4 sm:py-6 border-t border-neutral-200 dark:border-neutral-800">
            <div class=" ml-auto space-y-2">
              <div class="flex justify-between text-xs sm:text-sm">
                <span class="text-neutral-600 dark:text-neutral-400">Subtotal</span>
                <span class="text-neutral-900 dark:text-neutral-100 font-medium text-base sm:text-lg">
                  S/ {{ getValorVentaRedondeado(venta.subtotal || 0.0) }}
                </span>
              </div>
              <div class="flex justify-between text-xs sm:text-sm">
                <span class="text-neutral-600 dark:text-neutral-400">IGV (18%)</span>
                <span class="text-neutral-900 dark:text-neutral-100 font-medium text-base sm:text-lg">
                  S/ {{ getValorVentaRedondeado(venta.igv_total || 0.0) }}
                </span>
              </div>
              <div class="flex justify-between pt-2 border-t border-neutral-300 dark:border-neutral-700">
                <span class="font-semibold text-neutral-900 dark:text-neutral-100 text-sm sm:text-base">Total</span>
                <span class="font-bold text-neutral-900 dark:text-neutral-100 text-2xl sm:text-3xl">
                  S/ {{ getValorVentaRedondeado(venta.total || 0.0) }}
                </span>
              </div>
            </div>
          </div>

        </div>

      </div>

      <!-- Sidebar de Acciones -->
      <div class="lg:col-span-1 space-y-4 sm:space-y-6">





        <div class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 p-4 sm:p-6">
          <h3 class="text-sm font-semibold text-neutral-900 dark:text-neutral-100 mb-4">
            Acciones
          </h3>
          <div class="space-y-3">
            <button tuiButton appearance="floating" (click)="realizarComprobante()"
              [disabled]="loadingGenerarComprobante"
              class="w-full px-4 py-3 bg-neutral-900 dark:bg-white text-white dark:text-neutral-900 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2">
              <tui-loader *ngIf="loadingGenerarComprobante" size="s"
                class="text-white dark:text-neutral-900"></tui-loader>
              <span>Realizar comprobante</span>
              <tui-icon icon="@tui.step-forward"></tui-icon>
            </button>
          </div>
        </div>

        <!-- Card informativa -->
        <div class="bg-neutral-100 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 p-4 sm:p-6">
          <div class="flex items-start gap-3">
            <div
              class="flex-shrink-0 w-8 h-8 bg-neutral-900 dark:bg-white rounded-full flex items-center justify-center">
              <svg class="w-4 h-4 text-white dark:text-neutral-900" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <div>
              <h4 class="text-sm font-semibold text-neutral-900 dark:text-neutral-100 mb-1">
                Venta pendiente
              </h4>
              <p class="text-xs text-neutral-600 dark:text-neutral-400 leading-relaxed">
                Esta venta a煤n no tiene un comprobante generado. Genera el comprobante para poder descargar los
                documentos oficiales.
              </p>
            </div>
          </div>
        </div>

      </div>

    </div>
  </div>
</div>


<!-- Modal de preview responsive -->
<ng-template [(tuiPreviewDialog)]="open">
  <tui-preview>
    <tui-preview-title class="text-sm sm:text-base px-4">{{ titles[index] }}</tui-preview-title>
    <tui-preview-pagination [length]="length" [(index)]="index" />

    <button iconStart="@tui.x" tuiIconButton tuiPreviewAction type="button" (click)="open = false"
      class="text-sm sm:text-base">
      Close
    </button>

    <img *polymorpheusOutlet="content[index] as src" alt="preview" [src]="src"
      class="w-full h-auto max-h-[70vh] sm:max-h-[80vh] object-contain p-2 sm:p-4" />
  </tui-preview>
</ng-template>